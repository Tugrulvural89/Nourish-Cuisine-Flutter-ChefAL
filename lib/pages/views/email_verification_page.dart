import 'dart:async';import 'package:firebase_auth/firebase_auth.dart';import 'package:flutter/material.dart';import 'package:localization/localization.dart';class EmailVerificationScreen extends StatefulWidget {  const EmailVerificationScreen({super.key});  @override  State<EmailVerificationScreen> createState() =>        _EmailVerificationScreenState();}class _EmailVerificationScreenState extends State<EmailVerificationScreen> {  bool isEmailVerified = false;  Timer? timer;  @override  void initState() {    super.initState();    //FirebaseAuth.instance.currentUser?.sendEmailVerification();    timer = Timer.periodic(const Duration(seconds: 3), (timer) {      checkEmailVerified().then((isVerified) {        if(isVerified==true){          ScaffoldMessenger.of(context)              .showSnackBar(            SnackBar(              content: Text('email-verified'.i18n()),            ),          );        }      }      );    });  }  Future<bool>checkEmailVerified() async {    var user = FirebaseAuth.instance.currentUser;    await user?.reload();    if (user!.emailVerified) {      timer?.cancel();      setState(() {        isEmailVerified = true;      });    }    return isEmailVerified;  }  @override  void dispose() {    timer?.cancel();    super.dispose();  }  @override  Widget build(BuildContext context) {    return  Scaffold(appBar: AppBar(      title: Text('verify-email'.i18n()),    ),    body: SingleChildScrollView(child: Padding(      padding: const EdgeInsets.all(18.0),      child: Column(      children: [        const SizedBox(height: 40),        Image.asset('assets/images/emailverifications.png',          height: 200,          width: 200,        ),        const SizedBox(height: 40),         Text('verify-email'.i18n()),        const SizedBox(height: 40),         Text('check-email-message'.i18n()),        const SizedBox(height: 40),        !isEmailVerified ? const CircularProgressIndicator(          color: Colors.green,        )              : const SizedBox(),        const SizedBox(height: 40),        Text('wait-until-email-link-approved'.i18n()),        const SizedBox(height: 40),        isEmailVerified            ? ElevatedButton(                onPressed: () {                  Navigator.of(context).pushNamedAndRemoveUntil(                    '/recipes',                      (Route route) => false,                  );                },                child:  Text('continue'.i18n()),              )            : ElevatedButton(                onPressed: () {                  FirebaseAuth.instance.currentUser?.sendEmailVerification();                },                child:  Text('resend-email'.i18n()),              ),        const SizedBox(          height: 20,        ),        Row(          mainAxisAlignment: MainAxisAlignment.center,          children: [            Text('didnt-receive-email'.i18n()),            TextButton(              onPressed: () {                Navigator.of(context)                    .pushNamedAndRemoveUntil('/recipes',                        (Route route) => false,                );              },              child:  Text('continue'.i18n()),            ),          ],        ),      ],      ),    )),    );  }}